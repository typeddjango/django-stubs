-   case: test_every_model_has_objects_queryset_available
    main: |
        from myapp.models import User
        reveal_type(User.objects)  # N: Revealed type is 'django.db.models.manager.Manager[myapp.models.User]'
        reveal_type(User.objects.get())  # N: Revealed type is 'myapp.models.User*'
    installed_apps:
        - myapp
    files:
        -   path: myapp/__init__.py
        -   path: myapp/models.py
            content: |
                from django.db import models
                class User(models.Model):
                    pass

-   case: every_model_has_its_own_objects_queryset
    main: |
        from myapp.models import Parent, Child
        reveal_type(Parent.objects)  # N: Revealed type is 'django.db.models.manager.Manager[myapp.models.Parent]'
        reveal_type(Child.objects)  # N: Revealed type is 'django.db.models.manager.Manager[myapp.models.Child]'
    installed_apps:
        - myapp
    files:
        -   path: myapp/__init__.py
        -   path: myapp/models.py
            content: |
                from django.db import models
                class Parent(models.Model):
                    pass
                class Child(Parent):
                    pass


-   case: test_model_objects_attribute_present_in_case_of_model_cls_passed_as_generic_parameter
    main: |
        from myapp.models import Base, MyModel
        base_instance = Base(MyModel)
        reveal_type(base_instance.model_cls._default_manager)  # N: Revealed type is 'django.db.models.manager.Manager[myapp.models.MyModel]'
    installed_apps:
        - myapp
    files:
        -   path: myapp/__init__.py
        -   path: myapp/models.py
            content: |
                from typing import TypeVar, Generic, Type
                from django.db import models

                _T = TypeVar('_T', bound=models.Model)
                class Base(Generic[_T]):
                    def __init__(self, model_cls: Type[_T]):
                        self.model_cls = model_cls
                        reveal_type(self.model_cls._default_manager)  # N: Revealed type is 'django.db.models.manager.BaseManager[django.db.models.base.Model]'
                class MyModel(models.Model):
                    pass
                class Child(Base[MyModel]):
                    def method(self) -> None:
                        reveal_type(self.model_cls._default_manager)  # N: Revealed type is 'django.db.models.manager.Manager[myapp.models.MyModel]'


-   case: if_custom_manager_defined_it_is_set_to_default_manager
    main: |
        from myapp.models import MyModel
        reveal_type(MyModel._default_manager)  # N: Revealed type is 'myapp.models.CustomManager[myapp.models.MyModel]'
        reveal_type(MyModel._default_manager.get())  # N: Revealed type is 'myapp.models.MyModel*'
    installed_apps:
        - myapp
    files:
        -   path: myapp/__init__.py
        -   path: myapp/models.py
            content: |
                from django.db import models

                class CustomManager(models.Manager['MyModel']):
                    pass
                class MyModel(models.Model):
                    manager = CustomManager()


-   case: if_default_manager_name_is_passed_set_default_manager_to_it
    main: |
        from myapp.models import MyModel
        reveal_type(MyModel._default_manager)  # N: Revealed type is 'myapp.models.Manager2[myapp.models.MyModel]'
    installed_apps:
        - myapp
    files:
        -   path: myapp/__init__.py
        -   path: myapp/models.py
            content: |
                from django.db import models

                class Manager1(models.Manager['MyModel']):
                    pass
                class Manager2(models.Manager['MyModel']):
                    pass
                class MyModel(models.Model):
                    class Meta:
                        default_manager_name = 'm2'
                    m1 = Manager1()
                    m2 = Manager2()


-   case: manager_requires_type_annotation_to_be_set_if_generic_is_not_specified
    main: |
        from myapp.models import MyModel
        reveal_type(MyModel.objects)  # N: Revealed type is 'myapp.models.MyModel_MyManager[myapp.models.MyModel]'
        reveal_type(MyModel.objects.get())  # N: Revealed type is 'myapp.models.MyModel*'
        reveal_type(MyModel.objects2)  # N: Revealed type is 'myapp.models.MyGenericManager[Any]'
        reveal_type(MyModel.objects2.get())  # N: Revealed type is 'Any'
        reveal_type(MyModel.objects3)  # N: Revealed type is 'myapp.models.MyGenericManager[myapp.models.MyModel]'
        reveal_type(MyModel.objects3.get())  # N: Revealed type is 'myapp.models.MyModel*'
    installed_apps:
        - myapp
    files:
        -   path: myapp/__init__.py
        -   path: myapp/models.py
            content: |
                from typing import TypeVar
                from django.db import models

                class MyManager(models.Manager):
                    pass
                _T = TypeVar('_T', bound=models.Model)
                class MyGenericManager(models.Manager[_T]):
                    pass

                class MyModel(models.Model):
                    objects = MyManager()
                    objects2 = MyGenericManager()  # E: Need type annotation for 'objects2'
                    objects3: 'MyGenericManager[MyModel]' = MyGenericManager()


-   case: model_imported_from_different_file
    main: |
        from myapp.models import Inventory, Band
        reveal_type(Inventory.objects)  # N: Revealed type is 'django.db.models.manager.Manager[myapp.models.main.Inventory]'
        reveal_type(Band.objects)  # N: Revealed type is 'django.db.models.manager.Manager[myapp.models.Band]'
    installed_apps:
        - myapp
    files:
        -   path: myapp/__init__.py
        -   path: myapp/models/__init__.py
            content: |
                from django.db import models
                from .main import Inventory
                class Band(models.Model):
                    pass
        -   path: myapp/models/main.py
            content: |
                from django.db import models
                class Inventory(models.Model):
                    pass


-   case: managers_that_defined_on_other_models_do_not_influence
    main: |
        from myapp.models import AbstractPerson, Book
        reveal_type(AbstractPerson.abstract_persons)  # N: Revealed type is 'django.db.models.manager.Manager[myapp.models.AbstractPerson]'
        reveal_type(Book.published_objects)  # N: Revealed type is 'myapp.models.PublishedBookManager'
        Book.published_objects.create(title='hello')
        reveal_type(Book.annotated_objects)  # N: Revealed type is 'myapp.models.AnnotatedBookManager'
        Book.annotated_objects.create(title='hello')
    installed_apps:
        - myapp
    files:
        -   path: myapp/__init__.py
        -   path: myapp/models.py
            content: |
                from django.db import models

                class AbstractPerson(models.Model):
                    abstract_persons = models.Manager['AbstractPerson']()
                class PublishedBookManager(models.Manager['Book']):
                    pass
                class AnnotatedBookManager(models.Manager['Book']):
                    pass
                class Book(models.Model):
                    title = models.CharField(max_length=50)
                    published_objects = PublishedBookManager()
                    annotated_objects = AnnotatedBookManager()


-   case: managers_inherited_from_abstract_classes_multiple_inheritance_do_not_warn_on_liskov
    main: |
    installed_apps:
        - myapp
    files:
        -   path: myapp/__init__.py
        -   path: myapp/models.py
            content: |
                from django.db import models

                class CustomManager1(models.Manager['AbstractBase1']):
                    pass
                class AbstractBase1(models.Model):
                    class Meta:
                        abstract = True
                    name = models.CharField(max_length=50)
                    manager1 = CustomManager1()
                class CustomManager2(models.Manager['AbstractBase2']):
                    pass
                class AbstractBase2(models.Model):
                    class Meta:
                        abstract = True
                    value = models.CharField(max_length=50)
                    restricted = CustomManager2()

                class Child(AbstractBase1, AbstractBase2):
                    pass


-   case: model_has_a_manager_of_the_same_type
    main: |
        from myapp.models import UnrelatedModel, MyModel
        reveal_type(UnrelatedModel.objects) # N: Revealed type is 'django.db.models.manager.Manager[myapp.models.UnrelatedModel]'
        reveal_type(UnrelatedModel.objects.first()) # N: Revealed type is 'Union[myapp.models.UnrelatedModel*, None]'

        reveal_type(MyModel.objects) # N: Revealed type is 'django.db.models.manager.Manager[myapp.models.MyModel]'
        reveal_type(MyModel.objects.first()) # N: Revealed type is 'Union[myapp.models.MyModel*, None]'
    installed_apps:
        - myapp
    files:
        -   path: myapp/__init__.py
        -   path: myapp/models.py
            content: |
                from django.db import models

                class UnrelatedModel(models.Model):
                    objects = models.Manager['UnrelatedModel']()

                class MyModel(models.Model):
                    pass


-   case: inheritance_with_explicit_type_on_child_manager
    main: |
        from myapp.models import ParentOfMyModel4, MyModel4
        reveal_type(ParentOfMyModel4.objects) # N: Revealed type is 'django.db.models.manager.Manager[Any]'
        reveal_type(ParentOfMyModel4.objects.first()) # N: Revealed type is 'Union[Any, None]'

        reveal_type(MyModel4.objects) # N: Revealed type is 'django.db.models.manager.Manager[myapp.models.MyModel4]'
        reveal_type(MyModel4.objects.first()) # N: Revealed type is 'Union[myapp.models.MyModel4*, None]'
    installed_apps:
        - myapp
    files:
        -   path: myapp/__init__.py
        -   path: myapp/models.py
            content: |
                from django.db import models

                class ParentOfMyModel4(models.Model):
                    objects = models.Manager()  # E: Need type annotation for 'objects'

                class MyModel4(ParentOfMyModel4):
                    objects = models.Manager['MyModel4']()


-   case: custom_manager_annotate_method_before_type_declaration
    main: |
        from myapp.models import ModelA, ModelB, ManagerA
        reveal_type(ModelA.objects)  # N: Revealed type is 'myapp.models.ModelA_ManagerA1[myapp.models.ModelA]'
        reveal_type(ModelA.objects.do_something)  # N: Revealed type is 'def (other_obj: myapp.models.ModelB) -> builtins.str'
    installed_apps:
        - myapp
    files:
        - path: myapp/__init__.py
        - path: myapp/models.py
          content: |
              from django.db import models
              class ManagerA(models.Manager):
                    def do_something(self, other_obj: "ModelB") -> str:
                        return 'test'
              class ModelA(models.Model):
                    title = models.TextField()
                    objects = ManagerA()
              class ModelB(models.Model):
                    movie = models.TextField()


-   case: manager_defined_in_the_nested_class
    main: |
        from myapp.models import MyModel
        reveal_type(MyModel.objects)  # N: Revealed type is 'myapp.models.MyModel.MyManager'
        reveal_type(MyModel.objects.get())  # N: Revealed type is 'myapp.models.MyModel*'
        reveal_type(MyModel.objects.mymethod())  # N: Revealed type is 'builtins.int'
    installed_apps:
        - myapp
    files:
        -   path: myapp/__init__.py
        -   path: myapp/models.py
            content: |
                from django.db import models

                class MyModel(models.Model):
                    class MyManager(models.Manager['MyModel']):
                        def mymethod(self) -> int:
                            pass
                    objects = MyManager()


-   case: manager_method_is_forward_reference
    main: |
        from myapp.models import ModelA
        reveal_type(ModelA.objects.do_something())  # N: Revealed type is 'myapp.models.ModelB'
    installed_apps:
        - myapp
    files:
        -   path: myapp/__init__.py
        -   path: myapp/models.py
            content: |
                from django.db import models
                class ManagerA(models.Manager):
                    def do_something(self) -> "ModelB":
                        return ModelB.objects.create(movie="There's something about mypy")
                class ModelA(models.Model):
                    title = models.TextField()
                    objects = ManagerA()
                class ModelB(models.Model):
                    movie = models.TextField()
