- case: test_admin_decorators_display
  main: |
    from django.db import models

    from django.contrib import admin


    class MyModel(models.Model):
        @admin.display
        def display_bare(self) -> str: ...

        @admin.display(ordering="field", description="Something", empty_value="...")
        def display_fancy(self) -> bool: ...

        # Can also be a property
        @property
        @admin.display
        def display_property(self) -> str: ...

        @admin.display  # E: Decorators on top of @property are not supported  \[misc\]
        @property
        def incorrect_property(self) -> str: ...

        def method(self) -> None:
            reveal_type(self.display_bare)  # N: Revealed type is "def \(\) -> builtins.str"
            reveal_type(self.display_fancy)  # N: Revealed type is "def \(\) -> builtins.bool"
            reveal_type(self.display_fancy())  # N: Revealed type is "builtins.bool"
            reveal_type(self.display_property)  # N: Revealed type is "builtins.str"


    @admin.display
    def freestanding_display_bare(obj: MyModel) -> str: ...


    @admin.display(boolean=True)
    def freestanding_display_fancy(obj: MyModel) -> bool: ...


    @admin.register(MyModel, MyModel, site=None)
    class MyModelAdmin(admin.ModelAdmin[MyModel]):
        list_display = [
            "display_property",
            "display_fancy",
            "display_bare",
            "admin_display_bare",
            "admin_display_fancy",
            freestanding_display_bare,
            freestanding_display_fancy,
        ]

        @admin.display
        def admin_display_bare(self, obj: MyModel) -> str: ...

        @admin.display(boolean=True, ordering="field", description="Something")
        def admin_display_fancy(self, obj: MyModel) -> bool: ...

    # 'boolean' and 'empty_value' are mutually exclusive arguments
    # Erroneous
    admin.display(lambda: 1, boolean=True, empty_value="str")
    admin.display(lambda: 1, boolean=False, empty_value="str")
    # Valid
    admin.display(lambda: 1, boolean=True, empty_value=None)
    admin.display(lambda: 1, boolean=False, empty_value=None)
    admin.display(lambda: 1, boolean=True)
    admin.display(lambda: 1, boolean=False)
    admin.display(lambda: 1, boolean=None, empty_value="str")
    admin.display(lambda: 1, boolean=None, empty_value=None)
    admin.display(lambda: 1, empty_value="str")
    admin.display(lambda: 1, empty_value=None)
    admin.display(lambda: 1)
    # Erroneous
    admin.display(boolean=True, empty_value="str")
    admin.display(boolean=False, empty_value="str")
    # Valid
    admin.display(boolean=True, empty_value=None)
    admin.display(boolean=False, empty_value=None)
    admin.display(boolean=True)
    admin.display(boolean=False)
    admin.display(boolean=None, empty_value="str")
    admin.display(boolean=None, empty_value=None)
    admin.display(empty_value="str")
    admin.display(empty_value=None)
    admin.display()
  regex: true
  out: |
      main:57: error: No overload variant of "display" matches argument types "Callable\[\[\], int\]", "bool", "str"  \[call-overload\]
      main:57: note: Possible overload variants:
      main:57: note:     .*
      main:57: note:     .*
      main:57: note:     .*
      main:57: note:     .*
      main:58: error: No overload variant of "display" matches argument types "Callable\[\[\], int\]", "bool", "str"  \[call-overload\]
      main:58: note: Possible overload variants:
      main:58: note:     .*
      main:58: note:     .*
      main:58: note:     .*
      main:58: note:     .*
      main:70: error: No overload variant of "display" matches argument types "bool", "str"  \[call-overload\]
      main:70: note: Possible overload variants:
      main:70: note:     .*
      main:70: note:     .*
      main:70: note:     .*
      main:70: note:     .*
      main:71: error: No overload variant of "display" matches argument types "bool", "str"  \[call-overload\]
      main:71: note: Possible overload variants:
      main:71: note:     .*
      main:71: note:     .*
      main:71: note:     .*
      main:71: note:     .*

- case: test_admin_decorators_action
  main: |
    from django.db import models

    from django.contrib import admin
    from django.db.models import QuerySet
    from django.http import FileResponse, HttpRequest, HttpResponse


    class MyModel(models.Model): ...


    @admin.action
    def freestanding_action_bare(modeladmin: "MyModelAdmin", request: HttpRequest, queryset: QuerySet[MyModel]) -> None: ...


    @admin.action(description="Some text here", permissions=["test"])
    def freestanding_action_fancy(modeladmin: "MyModelAdmin", request: HttpRequest, queryset: QuerySet[MyModel]) -> None: ...

    @admin.action
    def freestanding_action_http_response(modeladmin: "MyModelAdmin", request: HttpRequest, queryset: QuerySet[MyModel]) -> HttpResponse: ...

    @admin.action
    def freestanding_action_file_response(modeladmin: "MyModelAdmin", request: HttpRequest, queryset: QuerySet[MyModel]) -> FileResponse: ...

    @admin.register(MyModel)
    class MyModelAdmin(admin.ModelAdmin[MyModel]):
        actions = [freestanding_action_bare, freestanding_action_fancy, "method_action_bare", "method_action_fancy", freestanding_action_http_response, freestanding_action_file_response]

        @admin.action
        def method_action_bare(self, request: HttpRequest, queryset: QuerySet[MyModel]) -> None: ...

        @admin.action(description="Some text here", permissions=["test"])
        def method_action_fancy(self, request: HttpRequest, queryset: QuerySet[MyModel]) -> None: ...

        @admin.action(description="Some text here", permissions=["test"])
        def method_action_http_response(self, request: HttpRequest, queryset: QuerySet[MyModel]) -> HttpResponse: ...

        @admin.action(description="Some text here", permissions=["test"])
        def method_action_file_response(self, request: HttpRequest, queryset: QuerySet[MyModel]) -> FileResponse: ...

        def method(self) -> None:
            reveal_type(self.method_action_bare)  # N: Revealed type is "def (request: django.http.request.HttpRequest, queryset: django.db.models.query.QuerySet[main.MyModel, main.MyModel])"
            reveal_type(self.method_action_fancy)  # N: Revealed type is "def (request: django.http.request.HttpRequest, queryset: django.db.models.query.QuerySet[main.MyModel, main.MyModel])"
            reveal_type(self.method_action_http_response)  # N: Revealed type is "def (request: django.http.request.HttpRequest, queryset: django.db.models.query.QuerySet[main.MyModel, main.MyModel]) -> django.http.response.HttpResponse"
            reveal_type(self.method_action_file_response)  # N: Revealed type is "def (request: django.http.request.HttpRequest, queryset: django.db.models.query.QuerySet[main.MyModel, main.MyModel]) -> django.http.response.FileResponse"
